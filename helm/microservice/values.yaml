# ===========================================================================
# Default values for the microservice Helm chart.
# Override per-app and per-environment in helm/values/<app>/<env>.yaml
# ===========================================================================

replicaCount: 1

image:
  repository: ""          # e.g. 123456789012.dkr.ecr.eu-central-1.amazonaws.com/php-app
  tag: "latest"
  pullPolicy: IfNotPresent

nameOverride: ""
fullnameOverride: ""

# ---------------------------------------------------------------------------
# Service Account — IRSA annotations go here when needed
# ---------------------------------------------------------------------------
serviceAccount:
  create: true
  annotations: {}
  name: ""

# ---------------------------------------------------------------------------
# Service
# ---------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 80
  targetPort: 8080

# ---------------------------------------------------------------------------
# Ingress — configured for AWS ALB Ingress Controller
# ---------------------------------------------------------------------------
ingress:
  enabled: false
  className: alb
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
    alb.ingress.kubernetes.io/healthy-threshold-count: "2"
    alb.ingress.kubernetes.io/unhealthy-threshold-count: "3"
  hosts:
    - paths:
        - path: /
          pathType: Prefix

# ---------------------------------------------------------------------------
# Resources
# ---------------------------------------------------------------------------
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi

# ---------------------------------------------------------------------------
# Autoscaling (HPA)
# ---------------------------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80

# ---------------------------------------------------------------------------
# Health Probes
# ---------------------------------------------------------------------------
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# ---------------------------------------------------------------------------
# Deployment strategy — maxUnavailable: 0 ensures zero-downtime rollouts
# If new pods fail health checks, old pods keep serving traffic (auto-rollback)
# ---------------------------------------------------------------------------
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# If deployment doesn't progress within 5 min, K8s marks it as failed
progressDeadlineSeconds: 300

# ---------------------------------------------------------------------------
# Environment variables (override per-app)
# ---------------------------------------------------------------------------
env: []

# ---------------------------------------------------------------------------
# Scheduling
# ---------------------------------------------------------------------------
nodeSelector: {}
tolerations: []
affinity: {}
